#!/bin/sh
#--------------------------------------------------------------------------------
# Script that move OS configuration files to containers 
#--------------------------------------------------------------------------------

#--------------------------------------------------------------------------------
# TODO:
#--------------------------------------------------------------------------------
OS_CONFIG_FOLD=/var/oscfg/
AUTH_CONF_FOLD=/var/autcfg/
SSID_DEST_FOLD=/containers/container-ext/var/hostapd-wifi/
SSID_CONF_FILE=${OS_CONFIG_FOLD}/com_wifi_ssid.conf
WEB_CERT_FILE=${AUTH_CONF_FOLD}/auth_https_cer.pem
WEB_DEST_FOLDER=/containers/container-web/var/services/webserver/
WEB_DFR_CRED_FILE=${OS_CONFIG_FOLD}/com_dfr_passw.conf
WEB_GSE_CRED_FILE=${OS_CONFIG_FOLD}/conf_gse_passw.conf

#--------------------------------------------------------------------------------
# MAIN
#--------------------------------------------------------------------------------
# check that configuration folders ain't empty
if [ -z "$(ls -A ${OS_CONFIG_FOLD})" ]; then
    echo -e "[FATAL] Empty configuration folder: ${OS_CONFIG_FOLD}"
    exit 1
fi

if [ -z "$(ls -A ${AUTH_CONFIG_FOLD})" ]; then
    echo -e "[FATAL] Empty configuration folder: ${AUTH_CONFIG_FOLD}"
    exit 1
fi

# copy wifi ssid configuration file
if [ -f ${SSID_CONF_FILE} ]; then
    echo -e "[NOTICE] copy ${SSID_CONF_FILE} to  ${SSID_DEST_FOLD}"
    cp ${SSID_CONF_FILE} ${SSID_DEST_FOLD}
fi

# copy https certificate to web container
if [ -f ${WEB_CERT_FILE} ]; then
    echo -e "[NOTICE] copy ${WEB_CERT_FILE} to  ${WEB_DEST_FOLDER}"
    cp ${WEB_CERT_FILE} ${WEB_DEST_FOLDER}
fi
# copy user credential to web container
if [ -f ${WEB_DFR_CRED_FILE} ]; then
    echo -e "[NOTICE] copy ${WEB_DFR_CRED_FILE} to  ${WEB_DEST_FOLDER}"
    cp ${WEB_DFR_CRED_FILE} ${WEB_DEST_FOLDER}
fi

# copy maintenance credential to web container
if [ -f ${WEB_GSE_CRED_FILE} ]; then
    echo -e "[NOTICE] copy ${WEB_GSE_CRED_FILE} to  ${WEB_DEST_FOLDER}"
    cp ${WEB_GSE_CRED_FILE} ${WEB_DEST_FOLDER}
fi

