#! /bin/sh
# This script should be called by udev rules when wlan is up

container_ext_pid_file=/var/run/container-ext-pid

# set device namespace to 'send' it to ext container
if [ -e ${container_ext_pid_file} ]; then
    iw phy phy0 set netns $(cat ${container_ext_pid_file})
    # make sure hostapd-wifi is restarted or at least started
    machinectl shell container-ext /bin/systemctl restart hostapd-wifi
    machinectl shell container-ext /bin/systemctl restart dhcprelay-wifi
else
    echo "[WIFI] cannot set wifi device namespace: container-ext not running\n" > /dev/kmsg
fi
