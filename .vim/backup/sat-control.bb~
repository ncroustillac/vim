DESCRIPTION = "Satellite module control application"
SECTION = "SAT"
LICENSE = "CLOSED"

inherit systemd

FILESEXTRAPATHS_prepend := "${THISDIR}/files:"

SRC_URI += "file://sat-control"
SRC_URI += "file://sat-control.service"
SRC_URI += "file://sat-control.path"
SRC_URI += "file://81-sat-serial.rules"

SYSTEMD_SERVICE_${PN} = "sat-control.service"
SYSTEMD_AUTO_ENABLE_${PN} = "enable"

RDEPENDS_${PN} = "hv3-gpio-ctrl"

do_install() {
  install -d ${D}/${systemd_unitdir}/system/
  install -m 0644 ${WORKDIR}/sat-control.service ${D}/${systemd_unitdir}/system/
  install -m 0644 ${WORKDIR}/sat-control.path ${D}/${systemd_unitdir}/system/

  install -d ${D}/usr/services/sat-control
  install -m 0755 ${WORKDIR}/sat-control ${D}/usr/services/sat-control
  
  install -d ${D}/etc/udev/rules.d

  # udev ttySC0 is up
  install -m 0644 ${WORKDIR}/81-sat-serial.rules ${D}/etc/udev/rules.d/
}

FILES_${PN} += "${systemd_unitdir}/system/"
FILES_${PN} += "/usr/services/sat-control"
FILES_${PN} += "/etc/udev/rules.d/81-sat-serial.rules"
