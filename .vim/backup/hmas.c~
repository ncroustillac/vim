#include <hmos.h>
#include <hmos_cyclops.h>
#include <unistd.h>
#include <string.h>
#include <stdlib.h>

int main ( void )
{
    struct timespec date;
    uint32_t i = 0;
    e_hmos_retcode rc;
    st_hmos_bite_data bite_status;
    char modeCreate[20];
    char modeDeux[20];
    int32_t fd;
    int32_t retval;
    int32_t status;
    const bool enable=true;
    bool notenabled=true;
    HMOS_initialize();

    HMOS_logPrint ( HMOS_LOG_CRIT_NOTICE, "HV3 HEATS  is started\n" );

    HMOS_isLoadAvailable ();

    rc = HMOS_getDateAndTime ( &date, NULL );
    if ( rc == HMOS_RETCODE_SUCCESS )
    {
        HMOS_logPrint ( HMOS_LOG_CRIT_NOTICE, "Initial posix date is %d\n", date.tv_sec );
    }
    else
    {
        HMOS_logPrint ( HMOS_LOG_CRIT_ERROR, "Initial posix date is unkown (maybe:%d), rc=%d\n", date.tv_sec, rc );
    }
    date.tv_sec = 1609459200;
    rc = HMOS_setDateAndTime ( &date );
    if ( rc == HMOS_RETCODE_SUCCESS )
    {
        HMOS_logPrint ( HMOS_LOG_CRIT_NOTICE, "Set time to %d succeed\n", date.tv_sec );
    }
    else
    {
        HMOS_logPrint ( HMOS_LOG_CRIT_ERROR, "Set date failed rc=%d\n", rc );
    }

    HMOS_logPrint ( HMOS_LOG_CRIT_NOTICE, "Retrieving BITE\n" );
    HMOS_getBITE ( &bite_status );
    HMOS_logPrint ( HMOS_LOG_CRIT_NOTICE, "BITE value : %u\n", bite_status.status );

    sleep(1);
   // HMOS_fetchRunningMode(mode);
   // HMOS_keepAlive();
   // HMOS_logPrint(HMOS_LOG_CRIT_NOTICE, "Current mode : %s\n", mode);
    //HMOS_fromOPtoLOADING();
   // HMOS_toSecured();
   // HMOS_keepAlive();
   // sleep(1);
    //HMOS_fetchRunningMode(modeDeux);
    //HMOS_logPrint(HMOS_LOG_CRIT_NOTICE, "Current mode : %s\n", modeDeux);
    //HMOS_keepAlive();
   // HMOS_WifiEnable(enable);
    HMOS_keepAlive();


//    while(1){
//      HMOS_logPrint(HMOS_LOG_CRIT_NOTICE, "Teeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeest");
//    }
    for ( ;; )
    {
        HMOS_keepAlive();
        if ( i == 0 )
        {
            HMOS_getDateAndTime ( &date, NULL );
            HMOS_logPrint ( HMOS_LOG_CRIT_NOTICE, "HV3 HEATS is running (date: %d)\n", date.tv_sec );
            i = 60;
            if(notenabled==true)HMOS_GSMEnable(enable);
            notenabled=false;
        }
        else if( i==30)
        {
<<<<<<< HEAD
            //HMOS_GSMEnable(!enable);
=======

            if(!onetime)HMOS_GSMEnable(true);
            onetime=true; 
            i=122;
            i--;
        }
        else if( i==121)
        {

            HMOS_transferFile(HMOS_TRANSFER_GSM,"/tmp/file.txt","/tmp/file2.txt");
            i=220;
>>>>>>> refs #6268 [GSM][middleware] Test in progress, merge wifi in progress
            i--;
        }
        else
        {
            i--;
        }

        sleep ( 1 );
    }

    HMOS_finalize();
}
