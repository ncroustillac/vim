SUMMARY = "Project-specific recipe to activate/deactivate wifi"
DESCRIPTION = "Project-specific script service reset W_DISABLE2_N and set W_DISABLE1_N"
LICENSE = "CLOSED"

inherit systemd allarch

SYSTEMD_SERVICE_${PN} = "wifi-enable.service"
SYSTEMD_AUTO_ENABLE_${PN} = "enable"
FILESEXTRAPATHS_prepend := "${THISDIR}/${BPN}:"

SRC_URI += "file://wifi-enable.sh"
SRC_URI += "file://wifi-enable.path"
SRC_URI += "file://wifi-enable.service"

# Script that is ran when wireless interface is created.
# This is called by an udev rule, see 'meta-hv3-bsp/recipes-udev/network'
SRC_URI += "file://wifi-set-netns.sh"

do_install() {
  install -d ${D}${systemd_unitdir}/system
  install -m 0644 ${WORKDIR}/wifi-enable.service ${D}${systemd_unitdir}/system
  install -m 0644 ${WORKDIR}/wifi-enable.path ${D}/${systemd_unitdir}/system/

  install -d ${D}/usr/services/wifi-enable
  install -m 0500 ${WORKDIR}/wifi-enable.sh ${D}/usr/services/wifi-enable
  install -m 0755 ${WORKDIR}/wifi-set-netns.sh ${D}/usr/services/wifi-enable
}

FILES_${PN} += "${systemd_unitdir}/system"
FILES_${PN} += "/usr/services/wifi-enable/wifi-enable.sh"
FILES_${PN} += "/usr/services/wifi-enable/wifi-set-netns.sh"

