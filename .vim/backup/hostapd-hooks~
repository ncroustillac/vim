#!/bin/sh
#--------------------------------------------------------------------------------
# Script that handle hostapd authentication notification 
#--------------------------------------------------------------------------------

#--------------------------------------------------------------------------------
# TODO:
#   * add flock
#

# check that event comes from the right interface
if [ "$1" != "ethext" ]; then
    echo "Unexpected interface: received event from $1"
    exit 1
fi

# Authentication success
if [ "$2" == "AP-STA-CONNECTED" ]; then
    # notify the firewall
    echo '1' > /var/services/acct-authorized/acct-authorized-eth
    # log a message
    logger -t $0 "ETHPMATS $3 on $1"
# authentication failure
elif [ "$2" == "CTRL-EVENT-EAP-FAILURE2" ]; then
    # only need to report failure in logs
    logger -t $0 "ETHPMATF $3 on $1"
# authentication timeout and/or disconnect
elif [ "$2" == "AP-STA-DISCONNECTED" ]; then
    # need only to notify the firewall
    echo '0' > /var/services/acct-authorized/acct-authorized-eth
fi
